


\lemmaone*
\lemmatwo*

\begin{proof}
    First by Jensen's inequality we know:
    \begin{align*}
        \frac{1}{M}\sum_{m\in[M]}\ee\sb{\norm{x_t-x_t^m}^4} \leq \frac{1}{M^2}\sum_{n\in[M]}\sum_{m\in[M]}\ee\sb{\norm{x_t^n-x_t^m}^4}
    \end{align*}
    Note the following about the fourth moment of the difference between the iterates on two machines $m,n\in[M]$ (where we denote $g_t^m := \nabla f(x_t^m; z_t^m)$ is the $t$-th stochastic gradient on machine $m$ and $\xi_{t}^m:=\nabla F_m(x_t^m) - g_t^m$),
    \begin{align*}
        &\ee\sb{\norm{x_t^m - x_t^n}^4}\\
        &= \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta g_{t-1}^m +\eta g_{t-1}^n}^4}\enspace,\\
        &= \ee\sb{\rb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n) + \eta \xi_{t-1}^m - \eta \xi_{t-1}^n}^2}^2}\enspace,\\
        &= \ee\Bigg[\bigg(\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2 + \eta^2 \norm{\xi_{t-1}^m -\xi_{t-1}^n}^2\\
        &\quad + 2\eta\inner{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}{\xi_{t-1}^m - \xi_{t-1}^n}\bigg)^2\Bigg]\enspace,\\
        &= \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^4} + \eta^4 \ee\sb{\norm{\xi_{t-1}^m -\xi_{t-1}^n}^4}\\
        &\quad +4\eta^2\ee\sb{\rb{\inner{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}{\xi_{t-1}^m - \xi_{t-1}^n}}^2}\\
        &\quad + 2\eta^2\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2\norm{\xi_{t-1}^m -\xi_{t-1}^n}^2}\\
        &\quad +4\eta^3\ee\sb{\inner{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}{\xi_{t-1}^m - \xi_{t-1}^n}\norm{\xi_{t-1}^m - \xi_{t-1}^n}^2}\\
        &\quad + 4\eta\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2\rb{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}}^{\top}\\
        &\quad \times \cancelto{0}{\ee\sb{\xi_{t-1}^m - \xi_{t-1}^n}}\enspace,\\
        &\leq^{\text{(C.S. Inequality, Assumption in \eqref{ass:stoch_bounded_moment})}} \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^4} + 8\sigma^4\eta^4\\
        &\quad + 6\eta^2\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2}\ee\sb{\norm{\xi_{t-1}^m -\xi_{t-1}^n}^2}\\
        &\quad +4\eta^3\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}}\ee\sb{\norm{\xi_{t-1}^m - \xi_{t-1}^n}^3}\enspace,
\end{align*}
In order to bound the term $\ee \sb{\norm{\xi^m_{t-1} - \xi^n_{t-1}}^3}$ we use Cauchy-Schwarz Inequality:
\begin{align*}
    \ee \sb{\norm{\xi^m_{t-1} - \xi^n_{t-1}}^3} &= \ee \sb{\norm{\xi^m_{t-1} - \xi^n_{t-1}}\cdot \norm{\xi^m_{t-1} - \xi^n_{t-1}}^2} \\
    &\leq \sqrt{\ee \sb{\norm{\xi^m_{t-1} - \xi^n_{t-1}}^2} \ee \sb{\norm{\xi^m_{t-1} - \xi^n_{t-1}}^4}} \stackrel{\text{Assumption (\ref{ass:stoch_bounded_moment})}}{\leq} 4\sqrt{\sigma^6}
\end{align*}
Also the term $\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}}$ can be bounded as: 
\begin{align*}
    \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}} \stackrel{\text{Jensen's Ineq.}}{\leq} \sqrt{\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2}}
\end{align*}
Putting everything back together gives us: 
\begin{align*}
        &\ee \sb{\norm{x^n_t - x^m_t}^4} \\
        &\stackrel{\text{(Assumption in \eqref{ass:stoch_bounded_moment})}}{\leq} \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^4} + 8\eta^4 \sigma^4\\
        &\quad +12\eta^2\sigma^2\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2}\\
        &\quad +16\eta^3\sqrt{\sigma^6 \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2}}\enspace,
\end{align*}
To bound the third term in the above inequality, we use the A.M. - G.M. Inequality $\sqrt{ab} \leq \frac{a}{2\gamma} + \frac{\gamma b}{2}$ for $\gamma >0$. Let $\gamma = \eta, a=\sigma^2 \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2}, b=\sigma^4$. We have:
\begin{align*}
    &16\eta^3\sqrt{\sigma^6 \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2}}\\
    &= 16\eta^3\sqrt{(\sigma^4) \left(\sigma^2 \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2}\right)} \\
    &\leq 16\eta^3 \left(\frac{\eta \sigma^4}{2} + \frac{\sigma^2}{2\eta}\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2} \right)
\end{align*}
So we have: 
\begin{align*}
        &\ee \sb{\norm{x^n_t - x^m_t}^4} \\
        &\leq \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^4} + 8\eta^4 \sigma^4 \\
        &\quad +12\eta^2\sigma^2\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2}\\
        &\quad +16\eta^3\rb{\frac{\eta\sigma^4}{2} +  \frac{\sigma^2}{2\eta}\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2}}\enspace,\\
        &= \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^4} \\
        &\quad +20\eta^2\sigma^2\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F_m(x_{t-1}^m) + \eta \nabla F_n(x_{t-1}^n)}^2} + 16\eta^4 \sigma^4\\
        &= \mathbb{E}\Bigr[\bigr\|x_{t-1}^m - x_{t-1}^n - \eta \nabla F(x_{t-1}^m) \\
        &\quad+ \eta\nabla F(x_{t-1}^n) + \eta (\nabla F(x_{t-1}^m) - \nabla F_m(x_{t-1}^m)) - \eta \rb{\nabla F(x_{t-1}^n) - \nabla F_n(x_{t-1}^n)}\bigr\|^4\Bigr]\\
        &\quad +20\eta^2\sigma^2\mathbb{E}\Bigr[\bigr\|x_{t-1}^m - x_{t-1}^n - \eta \nabla F(x_{t-1}^m) + \eta\nabla F(x_{t-1}^n)\\
        &\quad + \eta \rb{\nabla F(x_{t-1}^m) - \nabla F_m(x_{t-1}^m)} - \eta \rb{\nabla F(x_{t-1}^n) - \nabla F_n(x_{t-1}^n)}\bigr\|^2\Bigr]\\
        &\quad + 16\eta^4 \sigma^4
\end{align*}
Now by using Lemma \ref{Lemma: generalized triangle inequality} and generalized triangle inequality for fourth moment $\norm{a+b}^4 \leq \left(1+\frac{1}{\gamma} \right)^3\norm{a}^4 + (1+\gamma)^3 \norm{b}^4$ by choosing $\gamma = K-1$ we have: 
\begin{align*}
        &\leq \rb{1+\frac{1}{K-1}}^3\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F(x_{t-1}^m) + \eta\nabla F(x_{t-1}^n)}^4}\\ 
        &\quad + 2\eta^4K^3\ee\sb{\norm{\rb{\nabla F(x_{t-1}^m) - \nabla F_m(x_{t-1}^m)} - \rb{\nabla F(x_{t-1}^n) - \nabla F_n(x_{t-1}^n)}}^4}\\
        &\quad + 20\eta^2\sigma^2\rb{1+ \frac{1}{K-1}}\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F(x_{t-1}^m) + \eta\nabla F(x_{t-1}^n)}^2}\\
        &\quad + 20\eta^4\sigma^2K\ee\sb{\norm{\rb{\nabla F(x_{t-1}^m) - \nabla F_m(x_{t-1}^m)} - \rb{\nabla F(x_{t-1}^n) - \nabla F_n(x_{t-1}^n)}}^2}+ 16\eta^4 \sigma^4
\end{align*}
From the mean-value theorem we know that $\nabla F(x) - \nabla F(y) = \nabla^2 F(c)(x-y)$ for some $c = \lambda x + (1-\lambda) y$. By applying this theorem to the first and third term of the above inequality we have: 
\begin{align*}
    &\rb{1+\frac{1}{K-1}}^3\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - (\eta \nabla F(x_{t-1}^m) - \eta\nabla F(x_{t-1}^n))}^4} \\
    &= \rb{1+\frac{1}{K-1}}^3\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla^2 F(c)(x_{t-1}^m-x_{t-1}^n)}^4} \\
    &= \rb{1+\frac{1}{K-1}}^3\ee\sb{\norm{(I- \eta \nabla^2 F(c))(x_{t-1}^m - x_{t-1}^n)}^4} \\
    &\leq \rb{1+\frac{1}{K-1}}^3 (1- \eta \mu)^4 \ee \sb{\norm{x_{t-1}^m-x_{t-1}^n}^4}
\end{align*}
With the same approach for the third term we have: 
\begin{align*}
    &20\eta^2\sigma^2\rb{1+ \frac{1}{K-1}}\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n - \eta \nabla F(x_{t-1}^m) + \eta\nabla F(x_{t-1}^n)}^2} \\
    &\leq 20\eta^2\sigma^2\rb{1+ \frac{1}{K-1}}(1-\eta \mu)^2 \ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^2}
\end{align*}
Putting all together gives us: 
\begin{align*}
        &\ee \sb{\norm{x^n_t - x^m_t}^4} \\
        &\leq \rb{1+\frac{1}{K-1}}^3(1-\eta\mu)^4\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4}\\ 
        &\quad + 16\eta^4K^3\rb{\ee\sb{\norm{\nabla F(x_{t-1}^m) - \nabla F_m(x_{t-1}^m)}^4} + \ee\sb{\norm{\nabla F(x_{t-1}^n) - \nabla F_n(x_{t-1}^n)}^4}}\\
        &\quad + 20\eta^2\sigma^2\rb{1+ \frac{1}{K-1}}(1-\eta\mu)^2\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^2}\\
        &\quad + 40\eta^4\sigma^2K\rb{\ee\sb{\norm{\nabla F(x_{t-1}^m) - \nabla F_m(x_{t-1}^m)}^2} + \ee\sb{\norm{\nabla F(x_{t-1}^n) - \nabla F_n(x_{t-1}^n)}^2}}+ 16\eta^4 \sigma^4\enspace,\\
        &\leq \rb{1+\frac{1}{K-1}}^3(1-\eta\mu)^4\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4} + 32\eta^4K^3\zeta^4\\
        &\quad + 20\eta^2\sigma^2\rb{1+ \frac{1}{K-1}}(1-\eta\mu)^2\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^2} + 80\eta^4\sigma^2K\zeta^2+ 16\eta^4 \sigma^4\enspace,\\
        &\stackrel{\text{(Lemma \ref{lemma: weight variance upper bound})}}{\leq} \rb{1+\frac{1}{K-1}}^3\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4} + 32\eta^4K^3\zeta^4\\
        &\quad + 40\eta^2\sigma^2\rb{3K\sigma^2\eta^2 + 6K^2\eta^2\zeta^2} + 80\eta^4\sigma^2K\zeta^2+ 16\eta^4 \sigma^4\enspace,\\
        &\leq \rb{1+\frac{1}{K-1}}^3\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4} + 32\eta^4K^3\zeta^4 + 136\eta^4 K\sigma^4 +320 \eta^4\sigma^2K^2\zeta^2\enspace,\\
        &\leq \rb{1+\frac{1}{K-1}}^{3(K-1)}\rb{32\eta^4K^4\zeta^4 + 136\eta^4 K^2\sigma^4 +320 \eta^4\sigma^2K^3\zeta^2}\enspace,\\
        &\leq^{\text{(a)}} 20\rb{32\eta^4K^4\zeta^4 + 136\eta^4 K^2\sigma^4 +160\cdot2\cdot\rb{\eta^2\sigma^2K}\cdot\rb{\eta^2\zeta^2K^2}}\enspace,\\
        &\leq 20\rb{192\eta^4K^4\zeta^4 + 296\eta^4 K^2\sigma^4}\enspace,\\
        &\leq 3840\eta^4K^4\zeta^4 + 5920\eta^4 K^2\sigma^4\enspace,
        % &\leq \rb{1+\frac{1}{K-1}}^4(1-\eta\mu)^4\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4} + 36\eta^4K^2\zeta^4\\
        % &\quad + 20\eta^2\sigma^2\rb{1+ \frac{1}{K-1}}^2(1-\eta\mu)^2\sqrt{\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4}} + 120\eta^4\sigma^2K\zeta^2+ 100\eta^4 \sigma^4\enspace,\\
        % &= \rb{\rb{1+\frac{1}{K-1}}^2(1-\eta\mu)^2\sqrt{\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4}}}^2 + \rb{6\eta^2K\zeta^2}^2\\
        % &\quad + 2\cdot\rb{10\eta^2\sigma^2}\cdot\rb{\rb{1+\frac{1}{K-1}}^2(1-\eta\mu)^2\sqrt{\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4}}} + 2\cdot \rb{10\eta^2\sigma^2}\cdot\rb{6\eta^2K\zeta^2} + \rb{10\eta^2 \sigma^2}^2\enspace,\\
        % &\leq \rb{\rb{1+\frac{1}{K-1}}^2(1-\eta\mu)^2\sqrt{\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4}} + 6\eta^2K\zeta^2 + 10\eta^2 \sigma^2}^2\enspace,
    \end{align*}
    where in (a) we used that $(1+1/x)^x \leq 20$ for all $x\geq0$. 
    % Taking the square root of both sides leads to the following recursion,
    % \begin{align*}
    %     \sqrt{\ee\sb{\norm{x_t^m - x_t^n}^4}} &\leq \rb{1+\frac{1}{K-1}}^2(1-\eta\mu)^2\sqrt{\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4}} + 6\eta^2K\zeta^2 + 10\eta^2 \sigma^2\enspace,\\
    %     &\leq \rb{1+\frac{1}{K-1}}^2\sqrt{\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4}} + 6\eta^2K\zeta^2 + 10\eta^2 \sigma^2\enspace,\\
    %     &\leq K\cdot\rb{\rb{1+\frac{1}{K-1}}^2(1-\eta\mu)^2}^K\cdot\rb{6\eta^2K\zeta^2 + 10\eta^2 \sigma^2}\enspace,\\
    %     &\leq 9K\cdot\rb{6\eta^2K\zeta^2 + 10\eta^2 \sigma^2}\\
    %     &= 54\eta^2K^2\zeta^2 + 90\eta^2K\sigma^2\enspace.
    %     % &\leq \rb{1+\frac{1}{K-1}}\sqrt{\ee\sb{\norm{x_{t-1}^m - x_{t-1}^n}^4}} + 8\eta^2K\zeta^2 + 5\eta^2 \sigma^2\enspace,\\
    %     % &\leq  8\eta^2K^2\rb{1+\frac{1}{K-1}}^{K-1}\zeta^2 + 5K\rb{1+\frac{1}{K-1}}^{K-1}\eta^2 \sigma^2\enspace,\\
    %     % &\leq 24\eta^2K^2\zeta^2 + 15\eta^2K\sigma^2\enspace.
    % \end{align*}
    % Squaring this again implies,
    % \begin{align*}
    %     \ee\sb{\norm{x_t^m - x_t^n}^4} & \leq 5832\eta^4K^4\zeta^4 + 16200\eta^4K^2\sigma^4\enspace.
    % \end{align*}
    Finally averaging this over $m,n\in[M]$ implies,
    \begin{align*}
        \frac{1}{M}\sum_{m\in[M]}\ee\sb{\norm{x_t-x_t^m}^4} \leq \frac{1}{M^2}\sum_{m,n\in[M]}\ee\sb{\norm{x_t^n-x_t^m}^4} \leq 3840\eta^4K^4\zeta^4 + 5920\eta^4 K^2\sigma^4\enspace,
    \end{align*}
    which proves the lemma.
\end{proof}